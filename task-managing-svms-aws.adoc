---
sidebar: sidebar 
permalink: task-managing-svms-aws.html 
keywords: storage virtual machine, vserver, svm, storage vm, supported number, number supported 
summary: Uma VM de armazenamento é uma máquina virtual executada no ONTAP que fornece serviços de armazenamento e dados aos seus clientes.  Você pode conhecer isso como SVM ou vserver.  O Cloud Volumes ONTAP é configurado com uma VM de armazenamento por padrão, mas algumas configurações oferecem suporte a VMs de armazenamento adicionais. 
---
= Gerenciar VMs de armazenamento de serviço de dados para Cloud Volumes ONTAP na AWS
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Uma VM de armazenamento é uma máquina virtual executada no ONTAP que fornece serviços de armazenamento e dados aos seus clientes.  Você pode conhecer isso como _SVM_ ou _vserver_.  O Cloud Volumes ONTAP é configurado com uma VM de armazenamento por padrão, mas algumas configurações oferecem suporte a VMs de armazenamento adicionais.

Para criar VMs de armazenamento de serviço de dados adicionais, você precisa alocar endereços IP na AWS e, em seguida, executar comandos ONTAP com base na sua configuração do Cloud Volumes ONTAP .



== Número suportado de VMs de armazenamento

Várias VMs de armazenamento são suportadas com configurações específicas do Cloud Volumes ONTAP a partir da versão 9.7.  Vá para o https://docs.netapp.com/us-en/cloud-volumes-ontap-relnotes/index.html["Notas de versão do Cloud Volumes ONTAP"^] para verificar o número de VMs de armazenamento suportadas para sua versão do Cloud Volumes ONTAP.

Todas as outras configurações do Cloud Volumes ONTAP oferecem suporte a uma VM de armazenamento de serviço de dados e uma VM de armazenamento de destino usada para recuperação de desastres.  Você pode ativar a VM de armazenamento de destino para acesso a dados se houver uma interrupção na VM de armazenamento de origem.



== Verifique os limites para sua configuração

Cada instância do EC2 suporta um número máximo de endereços IPv4 privados por interface de rede.  Você precisa verificar o limite antes de alocar endereços IP na AWS para a nova VM de armazenamento.

.Passos
. Vai o https://docs.netapp.com/us-en/cloud-volumes-ontap-relnotes/reference-limits-aws.html["Seção de limites de armazenamento nas Notas de versão do Cloud Volumes ONTAP"^] .
. Identifique o número máximo de endereços IP por interface para seu tipo de instância.
. Anote esse número porque você precisará dele na próxima seção quando alocar endereços IP na AWS.




== Alocar endereços IP na AWS

Endereços IPv4 privados devem ser atribuídos à porta e0a na AWS antes de você criar LIFs para a nova VM de armazenamento.

Observe que um LIF de gerenciamento opcional para uma VM de armazenamento requer um endereço IP privado em um único sistema de nó e em um par de HA em uma única AZ.  Este LIF de gerenciamento fornece uma conexão com ferramentas de gerenciamento como o SnapCenter.

.Passos
. Faça login na AWS e abra o serviço EC2.
. Selecione a instância do Cloud Volumes ONTAP e clique em *Rede*.
+
Se você estiver criando uma VM de armazenamento em um par HA, selecione o nó 1.

. Role para baixo até *Interfaces de rede* e clique em *ID da interface* para a porta e0a.
+
image:screenshot_aws_e0a.gif["Uma captura de tela do console da AWS que mostra a porta e0a em uma interface de rede."]

. Selecione a interface de rede e clique em *Ações > Gerenciar endereços IP*.
. Expanda a lista de endereços IP para e0a.
. Verifique os endereços IP:
+
.. Conte o número de endereços IP alocados para confirmar se a porta tem espaço para IPs adicionais.
+
Você deve ter identificado o número máximo de endereços IP suportados por interface na seção anterior desta página.

.. Opcional: acesse a CLI do ONTAP para o Cloud Volumes ONTAP e execute *network interface show* para confirmar se cada um desses endereços IP está em uso.
+
Se um endereço IP não estiver em uso, você poderá usá-lo com a nova VM de armazenamento.



. De volta ao Console da AWS, clique em *Atribuir novo endereço IP* para atribuir endereços IP adicionais com base na quantidade necessária para a nova VM de armazenamento.
+
** Sistema de nó único: é necessário um IP privado secundário não utilizado.
+
Um IP privado secundário opcional é necessário se você quiser criar um LIF de gerenciamento na VM de armazenamento.

** Par HA em uma única AZ: Um IP privado secundário não utilizado é necessário no nó 1.
+
Um IP privado secundário opcional é necessário se você quiser criar um LIF de gerenciamento na VM de armazenamento.

** Par HA em várias AZs: um IP privado secundário não utilizado é necessário em cada nó.


. Se você estiver alocando o endereço IP em um par de HA em uma única AZ, habilite *Permitir que endereços IPv4 privados secundários sejam reatribuídos*.
. Clique em *Salvar*.
. Se você tiver um par de HA em várias AZs, precisará repetir essas etapas para o nó 2.




== Crie uma VM de armazenamento em um sistema de nó único

Essas etapas criam uma nova VM de armazenamento em um sistema de nó único.  Um endereço IP privado é necessário para criar um NAS LIF e outro endereço IP privado opcional é necessário se você quiser criar um LIF de gerenciamento.

.Passos
. Crie a VM de armazenamento e uma rota para ela.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Crie um NAS LIF.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address private_ip_x -netmask node1Mask -lif ip_nas_2 -home-node cvo-node
----
+
Onde _private_ip_x_ é um IP privado secundário não utilizado em e0a.

. Opcional: crie um LIF de gerenciamento de VM de armazenamento.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address private_ip_y -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node
----
+
Onde _private_ip_y_ é outro IP privado secundário não utilizado em e0a.

. Atribua um ou mais agregados à VM de armazenamento.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Esta etapa é necessária porque a nova VM de armazenamento precisa acessar pelo menos um agregado antes que você possa criar volumes na VM de armazenamento.





== Crie uma VM de armazenamento em um par de HA em uma única AZ

Essas etapas criam uma nova VM de armazenamento em um par de HA em uma única AZ.  Um endereço IP privado é necessário para criar um NAS LIF e outro endereço IP privado opcional é necessário se você quiser criar um LIF de gerenciamento.

Ambos os LIFs são alocados no nó 1.  Os endereços IP privados podem ser movidos entre nós se ocorrerem falhas.

.Passos
. Crie a VM de armazenamento e uma rota para ela.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Crie um NAS LIF no nó 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address private_ip_x -netmask node1Mask -lif ip_nas_2 -home-node cvo-node1
----
+
Onde _private_ip_x_ é um IP privado secundário não utilizado em e0a de cvo-node1.  Este endereço IP pode ser realocado para o e0a do cvo-node2 em caso de aquisição porque a política de serviço default-data-files indica que os IPs podem migrar para o nó parceiro.

. Opcional: crie um LIF de gerenciamento de VM de armazenamento no nó 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address private_ip_y -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node1
----
+
Onde _private_ip_y_ é outro IP privado secundário não utilizado em e0a.

. Atribua um ou mais agregados à VM de armazenamento.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Esta etapa é necessária porque a nova VM de armazenamento precisa acessar pelo menos um agregado antes que você possa criar volumes na VM de armazenamento.

. Se você estiver executando o Cloud Volumes ONTAP 9.11.1 ou posterior, modifique as políticas de serviço de rede para a VM de armazenamento.
+
A modificação dos serviços é necessária porque garante que o Cloud Volumes ONTAP possa usar o iSCSI LIF para conexões de gerenciamento de saída.

+
[source, cli]
----
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service data-fpolicy-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ad-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-dns-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ldap-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-nis-client
----




== Crie uma VM de armazenamento em um par de HA em várias AZs

Essas etapas criam uma nova VM de armazenamento em um par de HA em várias AZs.

Um endereço IP _flutuante_ é necessário para um NAS LIF e é opcional para um LIF de gerenciamento.  Esses endereços IP flutuantes não exigem que você aloque IPs privados na AWS.  Em vez disso, os IPs flutuantes são configurados automaticamente na tabela de rotas da AWS para apontar para o ENI de um nó específico na mesma VPC.

Para que IPs flutuantes funcionem com o ONTAP, um endereço IP privado deve ser configurado em cada VM de armazenamento em cada nó.  Isso se reflete nas etapas abaixo, onde um iSCSI LIF é criado no nó 1 e no nó 2.

.Passos
. Crie a VM de armazenamento e uma rota para ela.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Crie um NAS LIF no nó 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address floating_ip -netmask node1Mask -lif ip_nas_floating_2 -home-node cvo-node1
----
+
** O endereço IP flutuante deve estar fora dos blocos CIDR para todas as VPCs na região da AWS na qual você implanta a configuração de HA.  192.168.209.27 é um exemplo de endereço IP flutuante. link:reference-networking-aws.html#requirements-for-ha-pairs-in-multiple-azs["Saiba mais sobre como escolher um endereço IP flutuante"] .
** `-service-policy default-data-files`indica que os IPs podem migrar para o nó parceiro.


. Opcional: crie um LIF de gerenciamento de VM de armazenamento no nó 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address floating_ip -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node1
----
. Crie um iSCSI LIF no nó 1.
+
[source, cli]
----
network interface create -vserver svm_2 -service-policy default-data-blocks -home-port e0a -address private_ip -netmask nodei1Mask -lif ip_node1_iscsi_2 -home-node cvo-node1
----
+
** Este iSCSI LIF é necessário para dar suporte à migração LIF dos IPs flutuantes na VM de armazenamento.  Não precisa ser um iSCSI LIF, mas não pode ser configurado para migrar entre nós.
** `-service-policy default-data-block`indica que um endereço IP não migra entre nós.
** _private_ip_ é um endereço IP privado secundário não utilizado na eth0 (e0a) do cvo_node1.


. Crie um iSCSI LIF no nó 2.
+
[source, cli]
----
network interface create -vserver svm_2 -service-policy default-data-blocks -home-port e0a -address private_ip -netmaskNode2Mask -lif ip_node2_iscsi_2 -home-node cvo-node2
----
+
** Este iSCSI LIF é necessário para dar suporte à migração LIF dos IPs flutuantes na VM de armazenamento.  Não precisa ser um iSCSI LIF, mas não pode ser configurado para migrar entre nós.
** `-service-policy default-data-block`indica que um endereço IP não migra entre nós.
** _private_ip_ é um endereço IP privado secundário não utilizado na eth0 (e0a) do cvo_node2.


. Atribua um ou mais agregados à VM de armazenamento.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Esta etapa é necessária porque a nova VM de armazenamento precisa acessar pelo menos um agregado antes que você possa criar volumes na VM de armazenamento.

. Se você estiver executando o Cloud Volumes ONTAP 9.11.1 ou posterior, modifique as políticas de serviço de rede para a VM de armazenamento.
+
A modificação dos serviços é necessária porque garante que o Cloud Volumes ONTAP possa usar o iSCSI LIF para conexões de gerenciamento de saída.

+
[source, cli]
----
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service data-fpolicy-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ad-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-dns-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ldap-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-nis-client
----

